#!/usr/bin/env bash
set -euo pipefail
ROOT="$(cd "$(dirname "$0")" && pwd)"
SEASON_START="${SEASON_START:-2025-03-20}"
OUT_DIR="${OUT_DIR:-$ROOT/build/pdf}"
TEMPLATE="${TEMPLATE:-$ROOT/src/templates/hitter_report.html}"

if [ $# -lt 1 ]; then
  echo "Usage: ./report \"HITTER1\" [\"HITTER2\" ...]"
  exit 1
fi

if [ -d "$ROOT/venv" ]; then
  . "$ROOT/venv/bin/activate"
fi

cd "$ROOT/src"
for H in "$@"; do
  python generate_report.py --team AUTO --hitter "$H" --season_start "$SEASON_START" --out "$OUT_DIR" --template "$TEMPLATE"
done

if command -v open >/dev/null 2>&1; then open "$OUT_DIR"; elif command -v xdg-open >/dev/null 2>&1; then xdg-open "$OUT_DIR" >/dev/null 2>&1 & else echo "$OUT_DIR"; fi
